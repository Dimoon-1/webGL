<!DOCTYPE html>
<html>
    <head>
        <title>WebGL</title>

        <script id="vertex-shader" type="x-shader/x-vertex">
            attribute vec4 vPosition;
            attribute vec4 vColor;
            attribute vec3 a_normal;

            varying vec3 v_normal;

            varying vec4 fColor;

            uniform mat4 mView;
            uniform mat4 mViewInverseTranspose;
            uniform mat4 mProj;

            uniform vec3 theta; //for rotation
            uniform vec3 newPos; //for translation
            uniform vec3 scale; //for scaling

            void main() {
                vec3 angles = radians(theta);
                vec3 c = cos(angles);
                vec3 s = sin(angles);

                mat4 rx = mat4(
                    1.0,  0.0,  0.0, 0.0,
                    0.0,  c.x,  s.x, 0.0,
                    0.0, -s.x,  c.x, 0.0,
                    0.0,  0.0,  0.0, 1.0
                );

                mat4 ry = mat4( 
                    c.y, 0.0, -s.y, 0.0,
                    0.0, 1.0,  0.0, 0.0,
                    s.y, 0.0,  c.y, 0.0,
                    0.0, 0.0,  0.0, 1.0 
                );

                mat4 rz = mat4( 
                    c.z, s.z, 0.0, 0.0,
                    -s.z,  c.z, 0.0, 0.0,
                    0.0,  0.0, 1.0, 0.0,
                    0.0,  0.0, 0.0, 1.0
                );

                mat4 tr = mat4( 
                    1.0, 0.0, 0.0, 0.0,
                    0.0, 1.0, 0.0, 0.0,
                    0.0, 0.0, 1.0, 0.0,
                    newPos.x, newPos.y, newPos.z, 1.0 
                );
                
                mat4 scale = mat4( 
                    scale.x, 0.0, 0.0, 0.0,
                    0.0, scale.y, 0.0, 0.0,
                    0.0, 0.0, scale.z, 0.0,
                    0.0, 0.0, 0.0, 1.0 
                );

                gl_Position = mProj * mView * tr * rz * ry * rx * scale * vPosition;
                v_normal = mat3(mViewInverseTranspose * tr * rz * ry * rx) * a_normal;
                fColor = vColor;
            }
        </script>

        <script id="fragment-shader" type="x-shader/x-fragment">
            precision mediump float;

            varying vec3 v_normal;

            uniform vec3 u_reverseLightDirection;
            uniform vec4 u_color;

            varying vec4 fColor;

            void main() {
                vec3 normal = normalize(v_normal);
                float light = dot(normal, u_reverseLightDirection);

                gl_FragColor = fColor *  u_color;
                gl_FragColor.rgb *= light;
            }
        </script>

        <script type="text/javascript" src="lib/webgl-utils.js"></script>
        <script type="text/javascript" src="lib/initShaders.js"></script>
        <script type="text/javascript" src="lib/MV.js"></script>
        <script type="text/javascript" src="draw.js"></script>
    </head>

    <body onload="main()">
        <canvas id="mycanvas" width="512" height="512">
            Your browser doesn't support the HTML5 canvas element!
        </canvas>
        
        <div class="UI">
            <div>
                <input type="checkbox" id="in" name="cube" checked>
                <label for="cube">Draw Cube</label>
                
                <input type="checkbox" id="in" name="cone" checked>
                <label for="cone">Draw Cone</label>
                
                <input type="checkbox" id="in" name="sphere" checked>
                <label for="sphere">Draw Sphere</label>
            </div>

            <div>
                <div>
                    Transform: 
                    <input type="radio" id="transform" name="object" value="0" onchange="updateSliders(this)" checked>
                    <label for="cube">Cube</label>
                    
                    <input type="radio" id="transform" name="object" value="1" onchange="updateSliders(this)">
                    <label for="cone">Cone</label>
                    
                    <input type="radio" id="transform" name="object" value="2" onchange="updateSliders(this)">
                    <label for="sphere">Sphere</label>
                </div>

                <div style="float: left; width: 240px;">
                    <div>
                        rotateX
                        <input id="rotateX" type="range" min="-180" max="180" step="1" value="0" oninput="this.nextElementSibling.value = this.value">
                        <output>0</output>
                    </div>

                    <div>
                        rotateY
                        <input id="rotateY" type="range" min="-180" max="180" step="1" value="0" oninput="this.nextElementSibling.value = this.value">
                        <output>0</output>
                    </div>
                    
                    <div>
                        rotateZ
                        <input id="rotateZ" type="range" min="-180" max="180" step="1" value="0" oninput="this.nextElementSibling.value = this.value">
                        <output>0</output>
                    </div>
                </div>
                
                <div style="float: left; width: 240px;">
                    <div>
                        moveX
                        <input id="moveX" type="range" min="-5" max="5" step="0.1" value="-2" oninput="this.nextElementSibling.value = this.value">
                        <output>-2</output>
                    </div>

                    <div>
                        moveY
                        <input id="moveY" type="range" min="-5" max="5" step="0.1" value="0" oninput="this.nextElementSibling.value = this.value">
                        <output>0</output>
                    </div>
                    
                    <div>
                        moveZ
                        <input id="moveZ" type="range" min="-5" max="5" step="0.1" value="0" oninput="this.nextElementSibling.value = this.value">
                        <output>0</output>
                    </div>
                </div>
                
                <div style="float: left; width: 240px;">
                    <div>
                        scaleX
                        <input id="scaleX" type="range" min="0" max="5" step="0.1" value="1" oninput="this.nextElementSibling.value = this.value">
                        <output>1</output>
                    </div>
                    
                    <div>
                        scaleY
                        <input id="scaleY" type="range" min="0" max="5" step="0.1" value="1" oninput="this.nextElementSibling.value = this.value">
                        <output>1</output>
                    </div>

                    <div>
                        scaleZ
                        <input id="scaleZ" type="range" min="0" max="5" step="0.1" value="1" oninput="this.nextElementSibling.value = this.value">
                        <output>1</output>
                    </div>
                </div>
            </div>
            
            <!-- CAMERA -->
            <br><br><br><br>
            <div>
                <div>
                    radius
                    <input id="radius" type="range" min="0" max="50" step="0.1" value="8.3" oninput="this.nextElementSibling.value = this.value">
                    <output>8.3</output>
                </div>

                <div>
                    camPhi
                    <input id="camPhi" type="range" min="-180" max="180" step="1" value="-25" oninput="this.nextElementSibling.value = this.value">
                    <output>-25</output>
                </div>

                <div>
                    camTheta
                    <input id="camTheta" type="range" min="-180" max="180" step="1" value="-30" oninput="this.nextElementSibling.value = this.value">
                    <output>-30</output>
                </div>

                <div>
                    near
                    <input id="zNear" type="range" min="0.01" max="20" step="0.1" value="0.1" oninput="this.nextElementSibling.value = this.value">
                    <output>0.1</output>
                </div>
                
                <div>
                    far
                    <input id="zFar" type="range" min="1" max="100" step="1" value="50" oninput="this.nextElementSibling.value = this.value">
                    <output>50</output>
                </div>
                
                <div>
                    FOV
                    <input id="fov" type="range" min="10" max="120" step="1" value="45" oninput="this.nextElementSibling.value = this.value">
                    <output>45</output>
                </div>
                
                <div>
                    aspect
                    <input id="aspect" type="range" min="0.5" max="2" step="0.01" value="1" oninput="this.nextElementSibling.value = this.value">
                    <output>1</output>
                </div>
            </div>
        </div>
        
    </body>
</html>